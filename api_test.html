<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Datakom D500 MK3 API Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    button { border-radius: 5px; border-width: 1px; cursor: pointer; padding: 8px 16px; }
    #result { 
      margin-top: 2em; 
      white-space: pre-wrap; 
      background: #f8f8f8; 
      border: 1px solid #ccc; 
      padding: 1em;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.5;
      overflow: auto;
      max-height: 600px;
    }
    h2 { margin-bottom: 0.5em; }
    .block-btns {
      display: grid;
      gap: 0.5em;
      margin-bottom: 1em;
    }
    .block-btns_item {
      border: 1px solid grey;
      padding: 10px;
      border-radius: 5px;
    }
    .block-btns_item.line{
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .btn-hint {
      color: #666;
      font-size: 0.9em;
    }
    input[type="text"] {
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 3px;
      margin-right: 10px;
    }
    label {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>Datakom D500 MK3 API Test</h1>
  <p>–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è REST API –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ Datakom D500 MK3</p>
  
  <div class="block-btns">
    <div class="block-btns_item line">
      <button onclick="callApi('health')">üè• Health Check</button>
      <div class="btn-hint">–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É —Å–µ—Ä–≤–µ—Ä–∞ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞</div>
    </div>
    
    <div class="block-btns_item line">
      <button onclick="callApi('dump_devm')">üìä –í—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</button>
      <div class="btn-hint">–û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–µ–ª–µ–º–µ—Ç—Ä—ñ—ó</div>
    </div>
    
    <div class="block-btns_item">
      <div>
        <label>ID –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤: <input id="paramId" type="text" placeholder="–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, 0,5,10"></label>
        <button onclick="callApi('dump_devm?id=' + encodeURIComponent(document.getElementById('paramId').value))">üìà –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ ID</button>
      </div>
      <div class="btn-hint">–û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ —ó—Ö ID (—á–µ—Ä–µ–∑ –∫–æ–º—É)</div>
    </div>
    
    <div class="block-btns_item line">
      <button onclick="callApi('dump_devm_param_names')">üìù –°–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤</button>
      <div class="btn-hint">–û—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö ID —Ç–∞ –Ω–∞–∑–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤</div>
    </div>
    
    <div class="block-btns_item line">
      <button onclick="callApi('dump_devm_alarm')">‚ö†Ô∏è –ê–≤–∞—Ä—ñ—ó —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è</button>
      <div class="btn-hint">–û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—ñ –∞–≤–∞—Ä—ñ–π–Ω—ñ —Å–∏–≥–Ω–∞–ª–∏ (ShutDown, LoadDump, Warning)</div>
    </div>
  </div>
  
  <div id="result">–í—ñ–¥–ø–æ–≤—ñ–¥—å –∑'—è–≤–∏—Ç—å—Å—è —Ç—É—Ç...</div>
  
  <script>
    // Helper to format JSON response
    function formatResponse(text) {
      try {
        const json = JSON.parse(text);
        return JSON.stringify(json, null, 2);
      } catch (e) {
        // If not JSON, return as is
        return text;
      }
    }
    
    function getApiBase() {
      // API —á–µ—Ä–µ–∑ nginx proxy
      const protocol = window.location.protocol;
      const hostname = window.location.hostname;
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ (localhost/127.0.0.1)
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return `${protocol}//${hostname}:8765/api/`;
      }
      // –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–µ–º nginx proxy
      return `${protocol}//${hostname}/datakom/api/`;
    }
    
    async function callApi(endpoint) {
      document.getElementById('result').textContent = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
      try {
        const apiBase = getApiBase();
        const res = await fetch(apiBase + endpoint);
        const text = await res.text();
        document.getElementById('result').textContent = formatResponse(text);
      } catch (e) {
        document.getElementById('result').textContent = '–ü–æ–º–∏–ª–∫–∞: ' + e.message;
      }
    }
  </script>
</body>
</html>
